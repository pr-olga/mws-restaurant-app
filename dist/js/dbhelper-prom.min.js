class DBHelper{static createIDB(e){return idb.open("restaurant",1,function(e){var t=e.createObjectStore("restaurants",{keyPath:"id"});t.createIndex("name","name"),t.createIndex("is_favorite","is_favorite")})}static createIDBReviews(e){return idb.open("review",1,function(e){e.createObjectStore("reviews",{keyPath:"id"}).createIndex("restaurant_id","restaurant_id")})}static populateIDB(){return DBHelper.fetchRestaurantsFromServer().then(e=>{DBHelper.createIDB().then(function(t){var r=t.transaction("restaurants","readwrite"),n=r.objectStore("restaurants");return e.forEach(function(e){n.put(e)}),r.complete})})}static populateIDBReviews(){return DBHelper.fetchReviewsFromServer().then(e=>{DBHelper.createIDBReviews().then(function(t){var r=t.transaction("reviews","readwrite"),n=r.objectStore("reviews");return e.forEach(function(e){n.put(e)}),r.complete})})}static fetchRestaurantsFromIDB(){return DBHelper.createIDB().then(e=>{return e.transaction("restaurants","readonly").objectStore("restaurants").getAll()})}static fetchReviewsFromIDB(){return DBHelper.createIDBReviews().then(e=>{return e.transaction("reviews","readonly").objectStore("reviews").getAll()})}static fetchRestaurantsFromServer(){return fetch("http://localhost:1337/restaurants").then(function(e){if(!e.ok)throw Error(e.statusText);return e.json()}).catch(function(e){return console.log("Looks like there was a problem: \n",e),e})}static fetchRestaurants(){return DBHelper.fetchRestaurantsFromIDB().then(e=>""==e?DBHelper.fetchRestaurantsFromServer().then(e=>(DBHelper.populateIDB(e),e)):e)}static fetchReviews(){return DBHelper.fetchReviewsFromIDB().then(e=>""==e?DBHelper.fetchReviewsFromServer().then(e=>(DBHelper.populateIDBReviews(e),e)):e)}static fetchRestaurantById(e){return DBHelper.fetchRestaurants().then(t=>{return t.find(t=>t.id==e)})}static fetchRestaurantByCuisine(e){return DBHelper.fetchRestaurants().then(e=>{const t=e.map((t,r)=>e[r].cuisine_type);return t.filter(e=>e.cuisine_type==t)})}static fetchRestaurantByNeighborhood(e){return DBHelper.fetchRestaurants().then(e=>{const t=e.map((t,r)=>e[r].neighborhood);return t.filter(e=>e.neighborhood==t)})}static fetchRestaurantByCuisineAndNeighborhood(e,t){return DBHelper.fetchRestaurants(restaurants).then(r=>{let n=r;return"all"!=e&&(n=n.filter(t=>t.cuisine_type==e),console.log(n)),"all"!=t&&(n=n.filter(e=>e.neighborhood==t),console.log(t)),n})}static fetchNeighborhoods(){return DBHelper.fetchRestaurants().then(e=>{const t=e.map((t,r)=>e[r].neighborhood);return t.filter((e,r)=>t.indexOf(e)==r)})}static fetchCuisines(){return DBHelper.fetchRestaurants().then(e=>{const t=e.map((t,r)=>e[r].cuisine_type);return t.filter((e,r)=>t.indexOf(e)==r)})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return window.innerWidth<400?`./img/${e.photograph}_small.jpg`:`./img/${e.photograph}.jpg`}static imageAltForRestaurant(e){return`Photo of ${e.name} Restaurant`}static mapMarkerForRestaurant(e,t){const r=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:DBHelper.urlForRestaurant(e)});return r.addTo(newMap),r}static fetchReviewsFromServer(){return fetch("http://localhost:1337/reviews").then(function(e){if(!e.ok)throw Error(e.statusText);return e.json()}).catch(function(e){return console.log("Looks like there was a problem: \n",e),e})}static fetchReviewsById(e){return DBHelper.fetchReviews().then(t=>{return t.filter(t=>t.restaurant_id==e)})}static postReview(e,t,r,n){return event.preventDefault(),location.reload(),fetch("http://localhost:1337/reviews/",{method:"post",mode:"cors",headers:{Accept:"application/json","Content-type":"application/json"},body:JSON.stringify({restaurant_id:parseInt(e),name:t,rating:parseInt(r),comments:n})}).then(e=>e.json()).then(e=>{DBHelper.createIDBReviews().then(function(t){var r=t.transaction("reviews","readwrite");return r.objectStore("reviews").add(e),r.complete})})}static updateFavourite(e,t){return fetch(`http://localhost:1337/restaurants/${e}/?is_favorite=${t}`,{method:"put"}).then(e=>e.json()).then(e=>console.log(e))}}